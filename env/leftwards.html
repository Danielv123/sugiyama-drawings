<html>
	<head>
		<script src="js/lib/simgraph.js"></script>
		<script src="js/lib/utility.js"></script>
		<script src="js/lib/specialset.js"></script>
		<meta charset="UTF-8">
	</head>
	<body>
		<h2>
			leftward-edges-based with exploration of permutations
		</h2>
 		<table>
    		<tr>
        		<td>import csv file:</td>
        		<td><input type="file" id="fileToLoad"></td>
        		<td><button onclick="loadFileAsText()">ok</button><td>
        		<td><button onclick="execute()">execute</button><td>
                <td><button onclick="window.location='leftwards.html';">erase</button></td>
    		</tr>
    		<tr>
        		<td>save output as csv file:  </td>
        		<td><input id="inputFileNameToSaveAs"></input></td>
        		<td><button onclick="saveTextAsFile()">save</button></td>
    		</tr>
		</table>

		<table style="width:70%;">
    		<th><div valign="bottom" id="divID1"></div></th>
        	<th><div valign="bottom" id="divID2"></div></th>
		</table>	
		<br><br>
		<div valign="bottom" id="divID3"></div>
		</div>  
		<script type="text/javascript">
 			
 			var textFromFileLoaded="";
 			var graph2=new Simgraph();

 			function execute(){
 				var graph=createGraphFromCsv(textFromFileLoaded);
 				var div2 = document.getElementById('divID2');
 				var div1 = document.getElementById('divID1');
 				var div3 = document.getElementById('divID3');

 				div1.innerHTML = div1.innerHTML +"<h2>pre-leftward-edges</h2>"+ graph.getCsvForm("<br>");

 				//permutations

 				
				// Empty array to hold results
  				var lwcounter =[];
  				var result = [];
  				var input = graph.getVertices();
  				permutate(input, function (a) {
    				// Create a copy of a[] and add that to result[]
    				result.push(a.slice(0));
  				});
  				// Show result[]
  				for (var i = 0; i < result.length; i++) {
  					var s=new SpecialSet();
  					for (var j = 0; j < result[i].length; j++) {
  						div3.innerHTML = div3.innerHTML+result[i][j].getVertex()+", ";
  						s.addAll(result[i][j].getLinks4());
  						if(s.contains(result[i][j])) s.remove(result[i][j]);
  					};
  					lwcounter[i]=s.size();
  					div3.innerHTML = div3.innerHTML + lwcounter[i] + "<br>";
  				};
  				
  				var edges=new SpecialSet();
				var a=result[indexOfSmallest(lwcounter)];
				for (var j = 0; j < a.length; j++) {

  					edges.addAll(a[j].getLinks());
  					var targets=edges.getList().map(returnTarget);
  					
  					if(targets.indexOf(a[j])>=0){
  					 	var res=[];
  					 	for (var i = 0; i < edges.length; i++) {
  					 		if(edges[i].getSecondnode()!=a[j]) res.push(edges[i]);
  					 	};
  					 	edges.removeAll();
  					 	edges.addAll(res);
  					}
  				};
  				
  				edges.getList().map(returnEdgesInverted);

  				div2.innerHTML = div2.innerHTML +"<h2>post-leftward-edges</h2>"+ graph.getCsvLW("<br>");

  				graph2=graph;
 			}
 			function returnTarget(obj){
 				return obj.getSecondnode();
 			}
 			function returnEdgesInverted(obj){
 				obj.setInverted();
 				return obj.revEdge();
 			}
 			

			function saveTextAsFile(){
    			var textToSave = graph2.getCsvLW("\n");
    			var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
    			var textToSaveAsURL = window.URL.createObjectURL(textToSaveAsBlob);
    			var fileNameToSaveAs = document.getElementById("inputFileNameToSaveAs").value;
 
    			var downloadLink = document.createElement("a");
    			downloadLink.download = fileNameToSaveAs;
    			downloadLink.innerHTML = "Download File";
    			downloadLink.href = textToSaveAsURL;
    			downloadLink.onclick = destroyClickedElement;
    			downloadLink.style.display = "none";
    			document.body.appendChild(downloadLink);
 
    			downloadLink.click();
			}
			function destroyClickedElement(event){
				document.body.removeChild(event.target);
			}
			function loadFileAsText(){
				var fileToLoad = document.getElementById("fileToLoad").files[0];
    			var fileReader = new FileReader();
    			fileReader.onload = function(fileLoadedEvent){
					textFromFileLoaded = fileLoadedEvent.target.result;
					console.log(textFromFileLoaded);
				};
    			fileReader.readAsText(fileToLoad, "UTF-8");
			} 
		</script>
	</body>
</html>